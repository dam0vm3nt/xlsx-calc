!function(r,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t=e();for(var n in t)("object"==typeof exports?exports:r)[n]=t[n]}}(this,function(){return function(r){var e={};function t(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return r[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=r,t.c=e,t.d=function(r,e,n){t.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:n})},t.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,e){if(1&e&&(r=t(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var o in r)t.d(n,o,function(e){return r[e]}.bind(null,o));return n},t.n=function(r){var e=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(e,"a",e),e},t.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},t.p="",t(t.s=7)}([function(r,e,t){"use strict";r.exports=function(r){this.setValue=function(e){r=e},this.calc=function(){return r}}},function(r,e,t){"use strict";r.exports=function(r){for(var e,t=r+1,n="",o=10;t>0&&o--;)e=(t-1)%26,n=String.fromCharCode(e+65)+n,t=(t-e-1)/26;return n}},function(r,e,t){"use strict";r.exports=function(r){for(var e=0,t=r.replace(/[0-9]+$/,""),n=t.length;n--;)e+=Math.pow(26,t.length-n-1)*(t.charCodeAt(n)-64);return e-1}},function(r,e,t){"use strict";const n=t(4);r.exports=function(r,e){var t=this;this.name="RefValue",this.str_expression=r,this.formula=e,t.parseRef=function(){var t,o,i;if(-1!=r.indexOf("!")){var a=r.split("!");o=n(a[0]),t=e.wb.Sheets[o],i=a[1]}else t=e.sheet,o=e.sheet_name,i=r;if(!t)throw Error("Sheet "+o+" not found.");return{sheet:t,sheet_name:o,cell_name:i,cell_full_name:o+"!"+i}},this.calc=function(){var r=t.parseRef(),n=r.sheet,o=r.cell_name,i=r.cell_full_name,a=n[o];if(!a)return null;var s=e.formula_ref[i];if(!s){if("e"===a.t)throw console.log("ref is an error with no formula",o),new Error(a.w);return a.v}if("new"===s.status){if(e.exec_formula(s),"e"===a.t)throw console.log("ref is an error with new formula",o),new Error(a.w);return a.v}if("working"===s.status)throw new Error("Circular ref");if("done"===s.status){if("e"===a.t)throw console.log("ref is an error after formula eval"),new Error(a.w);return a.v}}}},function(r,e,t){"use strict";r.exports=function(r){var e=r.match(/^'(.*)'$/);return e?e[1]:r}},function(r,e,t){"use strict";const n=t(2),o=t(1),i=t(4);r.exports=function(r,e){this.calc=function(){var t,a,s;if(-1!=r.indexOf("!")){var f=r.split("!");a=i(f[0]),t=f[1]}else a=e.sheet_name,t=r;s=e.wb.Sheets[a];var l,u=t.split(":"),c=parseInt(u[0].replace(/^[A-Z]+/,""),10)||0,h=u[1].replace(/^[A-Z]+/,"");""===h&&s["!ref"]&&(h=s["!ref"].split(":")[1].replace(/^[A-Z]+/,"")),l=parseInt(""==h?"500000":h,10);for(var p=n(u[0]),g=n(u[1]),v=[],m=c;m<=l;m++){var w=[];v.push(w);for(var y=p;y<=g;y++){var x=o(y)+m,A=a+"!"+x;if(e.formula_ref[A]){if("new"===e.formula_ref[A].status)e.exec_formula(e.formula_ref[A]);else if("working"===e.formula_ref[A].status)throw new Error("Circular ref");w.push(s[x].v)}else s[x]?w.push(s[x].v):w.push(null)}}return v}}},function(r,e,t){"use strict";r.exports=function(r,e){let t={},n=[];for(let o in r.Sheets){let i=r.Sheets[o];for(let a in i)if(i[a]&&i[a].f){let s=t[o+"!"+a]={formula_ref:t,wb:r,sheet:i,sheet_name:o,cell:i[a],name:a,status:"new",exec_formula:e};n.push(s)}}return n}},function(r,e,t){"use strict";const n=t(1),o=t(2),i=t(8),a=t(6),s=t(14);var f=function(r){for(var e=a(r,i),t=e.length-1;t>=0;t--)i(e[t])};f.calculator=function(r){return new s(r,i)},f.set_fx=i.set_fx,f.exec_fx=i.exec_fx,f.col_str_2_int=o,f.int_2_col_str=n,f.import_functions=i.import_functions,f.import_raw_functions=i.import_raw_functions,f.xlsx_Fx=i.xlsx_Fx,r.exports=f},function(r,e,t){"use strict";const n=t(9),o=t(0),i=t(10),a=t(11);var s={},f={};c(t(12)),u(t(13));const l={"*":"multiply","+":"plus","-":"minus","/":"divide","^":"power","&":"concat","<":"lt",">":"gt","=":"eq"};function u(r,e){for(var t in r)f[t]=r[t]}function c(r,e){var t=(e=e||{}).prefix||"";for(var n in r){var o=r[n];"function"==typeof o?!e.override&&s[t+n]||(s[t+n]=o):"object"==typeof o&&c(o,h(e,{prefix:n+"."}))}}function h(r,e){var t=JSON.parse(JSON.stringify(r));for(var n in e)t[n]=e[n];return t}function p(r){var e;r.status="working";var t=r.cell.f;"="==t[0]&&(t=t.substr(1));for(var u=e=new n(r),c="",h=!1,p=!1,g=[{exp:u}],v=0;v<t.length;v++)if('"'==t[v])h?(u.push(new o(c)),h=!1,p=!0):h=!0,c="";else if(h)c+=t[v];else if("("==t[v]){var m,w=c.trim(),y=s[w],x=f[w];if(x)y=new a(x,r);else if(y)y=new i(y,r);else if(w)throw new Error('"'+r.sheet_name+'"!'+r.name+": Function "+c+" not found");m=new n(r),g.push({exp:m,special:y}),u=m,c=""}else if(l[t[v]])p||u.push(c),p=!1,u.push(t[v]),c="";else if(","===t[v]&&g[g.length-1].special)p=!1,g[g.length-1].exp.push(c),g[g.length-1].special.push(g[g.length-1].exp),g[g.length-1].exp=u=new n(r),c="";else if(")"==t[v]){var A,_=g.pop();(u=_.exp).push(c),A=u,c="",u=g[g.length-1].exp,_.special?(_.special.push(A),u.push(_.special)):u.push(A)}else c+=t[v];return e.push(c),e}function g(r){p(r).update_cell_value()}g.set_fx=function(r,e){s[r]=e},g.exec_fx=function(r,e){return s[r].apply(this,e)},g.import_functions=c,g.import_raw_functions=u,g.build_expression=p,g.xlsx_Fx=s,r.exports=g},function(r,e,t){"use strict";const n=t(0),o=t(3),i=t(5);var a=0;r.exports=function(r){var e,t=this;function s(r){if("function"!=typeof r.calc)throw new Error("Undefined "+r)}function f(r,e,t){for(var o=0;o<e.length;o++)if(e[o]===r)try{if(0===o&&"+"===r){s(e[o+1]);var i=e[o+1].calc();e.splice(o,2,new n(i))}else{s(e[o-1]),s(e[o+1]);i=t(e[o-1].calc(),e[o+1].calc());e.splice(o-1,3,new n(i)),o--}}catch(r){throw r}}t.id=++a,t.args=[],t.name="Expression",t.update_cell_value=function(){try{r.cell.v=t.calc(),"string"==typeof r.cell.v?r.cell.t="s":"number"==typeof r.cell.v&&(r.cell.t="n")}catch(t){var e={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43};if(void 0===e[t.message])throw t;r.cell.t="e",r.cell.w=t.message,r.cell.v=e[t.message]}finally{r.status="done"}},t.formula=r,t.calc=function(){let r=t.args.concat();if(function(r){for(var e=r.length;e--;)if("-"===r[e]){s(r[e+1]);var t=-r[e+1].calc();"string"!=typeof r[e-1]&&e>0?(r.splice(e,1,"+"),r.splice(e+1,1,new n(t))):r.splice(e,2,new n(t))}}(r),f("^",r,function(r,e){return Math.pow(+r,+e)}),f("/",r,function(r,e){if(0==e)throw Error("#DIV/0!");return+r/+e}),f("*",r,function(r,e){return+r*+e}),f("+",r,function(r,e){return+r+ +e}),f("&",r,function(r,e){return""+r+e}),f("<",r,function(r,e){return r<e}),f(">",r,function(r,e){return r>e}),f(">=",r,function(r,e){return r>=e}),f("<=",r,function(r,e){return r<=e}),f("<>",r,function(r,e){return r!=e}),f("=",r,function(r,e){return r==e}),1==r.length)return"function"!=typeof r[0].calc?r[0]:r[0].calc()},t.push=function(a){var s;a&&("="===(s=isNaN(a)?"string"==typeof a&&a.trim().replace(/\$/g,"").match(/^[A-Z]+[0-9]+:[A-Z]+[0-9]+$/)?new i(a.trim().replace(/\$/g,""),r):"string"==typeof a&&a.trim().replace(/\$/g,"").match(/^[^!]+![A-Z]+[0-9]+:[A-Z]+[0-9]+$/)?new i(a.trim().replace(/\$/g,""),r):"string"==typeof a&&a.trim().replace(/\$/g,"").match(/^[A-Z]+:[A-Z]+$/)?new i(a.trim().replace(/\$/g,""),r):"string"==typeof a&&a.trim().replace(/\$/g,"").match(/^[^!]+![A-Z]+:[A-Z]+$/)?new i(a.trim().replace(/\$/g,""),r):"string"==typeof a&&a.trim().replace(/\$/g,"").match(/^[A-Z]+[0-9]+$/)?new o(a.trim().replace(/\$/g,""),r):"string"==typeof a&&a.trim().replace(/\$/g,"").match(/^[^!]+![A-Z]+[0-9]+$/)?new o(a.trim().replace(/\$/g,""),r):"string"!=typeof a||isNaN(a.trim().replace(/%$/,""))?a:new n(+a.trim().replace(/%$/,"")/100):new n(+a))&&(">"==e||"<"==e)||"<"==e&&">"===s?t.args[t.args.length-1]+=s:t.args.push(s),e=s)}}},function(r,e,t){"use strict";r.exports=function(r){var e=this;e.name="UserFn",e.args=[],e.calc=function(){var t;try{t=r.apply(e,e.args.map(r=>r.calc()))}catch(e){if("is_blank"!==r.name||void 0==={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43}[e.message])throw e;t=0}return t},e.push=function(r){e.args.push(r)}}},function(r,e,t){"use strict";r.exports=function(r){var e=this;e.name="UserRawFn",e.args=[],e.calc=function(){return r.apply(e,e.args)},e.push=function(r){e.args.push(r)}}},function(r,e,t){"use strict";let n={FLOOR:Math.floor,"_xlfn.FLOOR.MATH":Math.floor,ABS:Math.abs,SQRT:Math.sqrt,VLOOKUP:function(r,e,t){for(var n=0;n<e.length;n++)if(e[n][0]==r)return e[n][t-1];throw Error("#N/A")},MAX:function(){for(var r=null,e=arguments.length;e--;){var t=arguments[e];if(Array.isArray(t))for(var n=t,o=n.length;o--;)r=null==r||r<n[o]?n[o]:r;else isNaN(t)?console.log("WTF??",t):r=null==r||r<t?t:r}return r},SUM:c,MIN:function(){for(var r=null,e=arguments.length;e--;){var t=arguments[e];if(Array.isArray(t))for(var n=t,o=n.length;o--;)r=null==r||r>n[o]?n[o]:r;else isNaN(t)?console.log("WTF??",t):r=null==r||r>t?t:r}return r},CONCATENATE:function(){for(var r="",e=0;e<arguments.length;e++){var t=arguments[e];null!==t&&void 0!==t&&(r+=t)}return r},PMT:function(r,e,t,n,o){if(o=o||0,n=n||0,0!=r){var i=Math.pow(1+r,e);return-r*(n+i*t)/((-1+i)*(1+r*o))}if(0!=e)return-(n+t)/e;return 0},COUNTA:u,IRR:function(r,e){var t=-2,n=1,o=0;do{for(var i=(t+n)/2,a=0,s=0;s<r.length;s++){var f=r[s];a+=f[0]/Math.pow(1+i,s)}a>0?(t===n&&(n+=Math.abs(i)),t=i):n=i,o++}while(Math.abs(a)>1e-6&&o<1e5);return i},"NORM.INV":l,"_xlfn.NORM.INV":l,STDEV:function(){var r=a(arguments);var e=function(r){return r.reduce(function(r,e){return r+e})/r.length}(r),t=r.map(function(r){return(r-e)*(r-e)});return Math.sqrt(t.reduce(function(r,e){return r+e})/(r.length-1))},AVERAGE:f,EXP:function(r){return Math.pow(Math.E,r)},LN:Math.log,"_xlfn.VAR.P":s,"VAR.P":s,"_xlfn.COVARIANCE.P":i,"COVARIANCE.P":i,TRIM:function(r){return(""+r).trim()},LEN:function(r){return(""+r).length},ISBLANK:o,HLOOKUP:function(r,e,t,n){if(void 0===r||o(r))return null;t=t||0;let i=e[0];for(let o=0;o<i.length;o++)if(n&&i[o]===r||-1!==i[o].toLowerCase().indexOf(r.toLowerCase()))return t<e.length+1?e[t-1][o]:e[0][o];throw Error("#N/A")},INDEX:function(r,e,t){if(e<=r.length){var n=r[e-1];if(!Array.isArray(n))return r[e];if(!t)return n;if(t<=n.length)return n[t-1]}throw Error("#REF!")},MATCH:function(r,e,t){Array.isArray(e)&&1===e.length&&Array.isArray(e[0])&&(e=e[0]);if(!r&&!e)throw Error("#N/A");2===arguments.length&&(t=1);if(!(e instanceof Array))throw Error("#N/A");if(-1!==t&&0!==t&&1!==t)throw Error("#N/A");for(var n,o,i=0;i<e.length;i++)if(1===t){if(e[i]===r)return i+1;e[i]<r&&(o?e[i]>o&&(n=i+1,o=e[i]):(n=i+1,o=e[i]))}else if(0===t){if("string"==typeof r){if(r=r.replace(/\?/g,"."),Array.isArray(e[i])){if(1===e[i].length&&"string"==typeof e[i][0]&&e[i][0].toLowerCase()===r.toLowerCase())return i+1}else if("string"==typeof e[i]&&e[i].toLowerCase()===r.toLowerCase())return i+1}else if(e[i]===r)return i+1}else if(-1===t){if(e[i]===r)return i+1;e[i]>r&&(o?e[i]<o&&(n=i+1,o=e[i]):(n=i+1,o=e[i]))}if(!n)throw Error("#N/A");return n},SUMPRODUCT:function(){var r=function(r){return void 0===r||""===r||null===r?0:isNaN(r)?0:parseFloat(r)};if(!arguments||0===arguments.length)throw Error("#VALUE!");if(!function(r){for(var e=function(r){return r.length},t=function(r){return r[0].length},n=e(r[0]),o=t(r[0]),i=1;i<r.length;i++)if(e(r[i])!==n||t(r[i])!==o)return!1;return!0}(arguments))throw Error("#VALUE!");for(var e,t,n,o,i=arguments.length+1,a=0,s=0;s<arguments[0].length;s++)if(arguments[0][s]instanceof Array)for(var f=0;f<arguments[0][s].length;f++){for(e=1,t=1;t<i;t++)o=r(arguments[t-1][s][f]),e*=o;a+=e}else{for(e=1,t=1;t<i;t++)n=r(arguments[t-1][s]),e*=n;a+=e}return a},ISNUMBER:function(r){return!isNaN(r)}};function o(r){return!r}function i(r,e){if(r=a(r),e=a(e),r.length!=e.length)return"N/D";for(var t=1/r.length,n=c.apply(this,r)/r.length,o=c.apply(this,e)/e.length,i=0,s=0;s<r.length;s++)i+=(r[s]-n)*(e[s]-o);return i*t}function a(r){for(var e=[],t=0;t<r.length;t++){var n=r[t];if(Array.isArray(n)){for(var o=n,i=o.length;i--;)if("number"==typeof o[i])e.push(o[i]);else if(Array.isArray(o[i]))for(var a=o[i].length;a--;)"number"==typeof o[i][a]&&e.push(o[i][a])}else"number"==typeof n&&e.push(n)}return e}function s(){for(var r=f.apply(this,arguments),e=0,t=0,n=0;n<arguments.length;n++){var o=arguments[n];if(Array.isArray(o))for(var i=o,a=i.length;a--;)for(var s=i[a].length;s--;)null!==i[a][s]&&void 0!==i[a][s]&&(e+=Math.pow(i[a][s]-r,2),t++);else e+=Math.pow(o-r,2),t++}return e/t}function f(){return c.apply(this,arguments)/u.apply(this,arguments)}function l(r,e,t){if(r<0||r>1)throw"The probality p must be bigger than 0 and smaller than 1";if(t<0)throw"The standard deviation sigma must be positive";return 0==r?-1/0:1==r?1/0:0==t?e:(n=r-.5,Math.abs(n)<=.425?i=n*(((((((2509.0809287301227*(o=.180625-n*n)+33430.57558358813)*o+67265.7709270087)*o+45921.95393154987)*o+13731.69376550946)*o+1971.5909503065513)*o+133.14166789178438)*o+3.3871328727963665)/(((((((5226.495278852854*o+28729.085735721943)*o+39307.89580009271)*o+21213.794301586597)*o+5394.196021424751)*o+687.1870074920579)*o+42.31333070160091)*o+1):(o=n>0?1-r:r,i=(o=Math.sqrt(-Math.log(o)))<=5?(((((((.0007745450142783414*(o+=-1.6)+.022723844989269184)*o+.2417807251774506)*o+1.2704582524523684)*o+3.6478483247632045)*o+5.769497221460691)*o+4.630337846156546)*o+1.4234371107496835)/(((((((1.0507500716444169e-9*o+.0005475938084995345)*o+.015198666563616457)*o+.14810397642748008)*o+.6897673349851)*o+1.6763848301838038)*o+2.053191626637759)*o+1):(((((((2.0103343992922881e-7*(o+=-5)+27115555687434876e-21)*o+.0012426609473880784)*o+.026532189526576124)*o+.29656057182850487)*o+1.7848265399172913)*o+5.463784911164114)*o+6.657904643501103)/(((((((2.0442631033899397e-15*o+1.421511758316446e-7)*o+18463183175100548e-21)*o+.0007868691311456133)*o+.014875361290850615)*o+.1369298809227358)*o+.599832206555888)*o+1),n<0&&(i=-i)),e+t*i);var n,o,i}function u(){for(var r=0,e=arguments.length;e--;){var t=arguments[e];if(Array.isArray(t))for(var n=t,o=n.length;o--;)for(var i=n[o].length;i--;)null!==n[o][i]&&void 0!==n[o][i]&&r++;else null!==t&&void 0!==t&&r++}return r}function c(){for(var r=0,e=arguments.length;e--;){var t=arguments[e];if(Array.isArray(t))for(var n=t,o=n.length;o--;)for(var i=n[o].length;i--;)isNaN(n[o][i])||(r+=+n[o][i]);else r+=+t}return r}r.exports=n},function(r,e,t){"use strict";const n=t(1),o=t(2),i=t(0),a=t(5),s=t(3);r.exports={OFFSET:function(r,e,t,f,l){if(f=(f||new i(1)).calc(),l=(l||new i(1)).calc(),1===r.args.length&&"RefValue"===r.args[0].name){var u=r.args[0],c=u.parseRef(),h=o(c.cell_name)+t.calc(),p=n(h),g=+c.cell_name.replace(/^[A-Z]+/g,"")+e.calc(),v=p+g;if(1===f&&1===l)return new s(v,u.formula).calc();var m=n(h+l-1)+(g+f-1),w=c.sheet_name+"!"+v+":"+m;return new a(w,u.formula).calc()}},IFERROR:function(r,e){try{var t=r.calc();return"number"!=typeof t||!isNaN(t)&&t!==1/0&&t!==-1/0?t:e.calc()}catch(r){return e.calc()}},IF:function(r,e,t){return r.calc()?e.calc():t.calc()},AND:function(){for(var r=0;r<arguments.length;r++)if(!arguments[r].calc())return!1;return!0}}},function(r,e,t){"use strict";const n=t(0),o=t(6);r.exports=class{constructor(r,e){this.workbook=r,this.expressions=[],this.exec_formula=e,this.variables={};let t=o(r,e);for(let r=t.length-1;r>=0;r--){let n=e.build_expression(t[r]);this.expressions.push(n)}}setVar(r,e){let t=this.variables[r];t?t.setValue(e):this.expressions.forEach(t=>{this.setVarOfExpression(t,r,e)})}getVars(){let r={};for(let e in this.variables)r[e]=this.variables[e].calc();return r}setVarOfExpression(r,e,t){for(let o=0;o<r.args.length;o++){let i=r.args[o];i===e?r.args[o]=this.variables[e]||(this.variables[e]=new n(t)):"object"!=typeof i||"Expression"!==i.name&&"UserFn"!==i.name||this.setVarOfExpression(i,e,t)}}execute(){this.expressions.forEach(r=>{r.update_cell_value()})}}}])});
//# sourceMappingURL=xlsx-calc.js.map